try{window.performance.mark("async-heartbeat.js:eval-start")}catch(e){}(window.webpackJsonp=window.webpackJsonp||[]).push([["async-heartbeat"],{"0tAR":function(t,a,n){"use strict";n.r(a),n.d(a,"redirect",(function(){return p}));var c=n("q1tI"),i=n.n(c),s=n("i8i4"),r=n("RmIm"),o=n("LfjC");const l=[408,500,502,503,504,522,524];async function u(e,t={},a=5,n=300){const c=await fetch(e,t);return c.ok||401===c.status?c:a>0&&l.includes(c.status)?(await function(e){return new Promise((t=>setTimeout(t,e)))}(n),await u(e,t,a-1,2*n)):Promise.reject(c)}const d=(t,a,n)=>{const[i,s]=Object(c.useState)(void 0),[r,o]=Object(c.useState)(void 0),[d,m]=Object(c.useState)(!1),[b,f]=Object(c.useState)(!1);return Object(c.useEffect)((()=>{if(d&&t&&!b){const c=async()=>{try{const c=await(async(t,a,n)=>{try{const e=await u(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}});if(e&&e.ok)return e.json();if(e&&401===e.status&&a)return void a()}catch(e){const a=e
;if(400===a.status)return null==n||n(),Promise.reject(a);l.includes(a.status)&&console.warn("Heartbeat: Retried 5x, stopped to call api")}})(t,a,n);m(!1),c&&c.nextCallTimestamp&&s(new Date(c.nextCallTimestamp)),c&&c.sessionExpiryTime&&o(new Date(c.sessionExpiryTime))}catch(c){f(!0)}};c()}}),[d,t,a,n,b]),{nextCallTimestamp:i,sessionExpiryTimestamp:r,callHeartbeatService:d,setCallHeartbeatService:m,deactivated:b}},m=(e,t,a,n)=>{const{nextCallTimestamp:i,sessionExpiryTimestamp:s,callHeartbeatService:l,setCallHeartbeatService:u,deactivated:m}=d(e,a,n),{active:b,tabActive:f}=(e=>{const[t,a]=Object(c.useState)(!0),[n,i]=Object(c.useState)(!0),s=Object(c.useRef)(t);return s.current=t,Object(c.useEffect)((()=>{let t;return t=new o.a({idleTimeoutMs:e,stopTimerOnTabchange:!1,browserTabActiveCallbacks:[()=>{i(!0)}],browserTabInactiveCallbacks:[()=>{i(!1)}],idleCallbacks:[()=>{s.current&&a(!1)}],activeCallbacks:[()=>{s.current||a(!0)}]}),t.startTimer(),()=>{t&&t.destroy(),t=null}}),[e]),{active:t,
tabActive:n}})(t);return Object(c.useEffect)((()=>{u(!0)}),[]),Object(c.useEffect)((()=>{!b&&f&&u(!0)}),[b,f,u]),Object(r.a)((()=>{l||(s&&s.getTime()<=Date.now()||b&&f&&i&&i.getTime()<=Date.now())&&u(!0)}),1e4),{nextCallTimestamp:i,sessionExpiryTimestamp:s,active:b,tabActive:f,deactivated:m}};var b=({endpoint:e="/gateway/api/session/heartbeat",idleTime:t=6e4,onAuthenticationFailed:a,onBadRequest:n})=>(m(e,t,a,n),null);Object(n("VJ5L").a)();const f=document.createElement("div");f.id="heartbeat",document.body&&document.body.appendChild(f);const p=e=>{let t="";"staging"===e?t="id.stg.internal.atlassian.com":"prod"===e&&(t="id.atlassian.com");const a=`https://${t}/login?application=jira&continue=${encodeURIComponent(window.location.href)}`;window.location.assign(a)};Object(s.render)(i.a.createElement(n("rZxA").a,null,i.a.createElement(n("QwAD").b,null,(({tenantContext:{environment:e,isAnonymous:t}})=>!t&&i.a.createElement(n("9UX1").a,{id:"heartbeat"},i.a.createElement(b,{
onAuthenticationFailed:()=>p(e)}))))),f)},H6vi:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return s}));const n=window||e,c=e=>e({isSuccess:!0}),i=e=>e({isSuccess:!1}),s=(e=c)=>{Object(a("0zaF").b)("fe.platform.healthcheck.allfail.enabled",!1)?n.performHealthcheck=i:n.performHealthcheck=e}}).call(this,a("yLpj"))},RmIm:function(e,t,a){"use strict";var n=a("q1tI");t.a=function(e,t){var a=Object(n.useRef)();Object(n.useEffect)((function(){a.current=e}),[e]),Object(n.useEffect)((function(){if(null!==t){var e=setInterval((function(){return a.current.apply(a,arguments)}),t);return function(){return clearInterval(e)}}}),[t])}},VJ5L:function(e,t,a){"use strict";a.d(t,"a",(function(){return a("H6vi").a}))}}]);try{window.__jsEvalStop("async-heartbeat.js")}catch(e){}
//# sourceMappingURL=https://statlas.prod.atl-paas.net/jira-frontend-source-maps/assets/async-heartbeat.8b7687f3aedb1069f5a2.8.js.map